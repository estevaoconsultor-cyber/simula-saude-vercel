import MaterialIcons from "@expo/vector-icons/MaterialIcons";
import { SymbolWeight, SymbolViewProps } from "expo-symbols";
import { ComponentProps } from "react";
import { OpaqueColorValue, Platform, type StyleProp, type TextStyle } from "react-native";
import Svg, { Path } from "react-native-svg";

type IconMapping = Record<SymbolViewProps["name"], ComponentProps<typeof MaterialIcons>["name"]>;
type IconSymbolName = keyof typeof MAPPING;

const MAPPING = {
  "house.fill": "home",
  "building.2.fill": "business",
  "paperplane.fill": "send",
  "chevron.left.forwardslash.chevron.right": "code",
  "chevron.right": "chevron-right",
  "heart.fill": "favorite",
  "person.fill": "person",
  "doc.text.fill": "description",
  "magnifyingglass": "search",
  "book.fill": "menu-book",
  "phone.fill": "phone",
  "message.fill": "chat",
  "questionmark.circle.fill": "help",
  "gearshape.fill": "settings",
  "person.circle.fill": "account-circle",
  "chart.bar.fill": "bar-chart",
  "bubble.left.and.bubble.right.fill": "forum",
} as IconMapping;

// SVG paths for web (Material Icons equivalents, viewBox 0 0 24 24)
const SVG_PATHS: Record<string, string> = {
  "home": "M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z",
  "menu-book": "M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1zm0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5v11z",
  "phone": "M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z",
  "account-circle": "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z",
  "bar-chart": "M5 9.2h3V19H5zM10.6 5h2.8v14h-2.8zm5.6 8H19v6h-2.8z",
  "forum": "M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z",
};

/**
 * An icon component that uses native SF Symbols on iOS, Material Icons on Android,
 * and SVG icons on web for reliable cross-browser rendering.
 */
export function IconSymbol({
  name,
  size = 24,
  color,
  style,
}: {
  name: IconSymbolName;
  size?: number;
  color: string | OpaqueColorValue;
  style?: StyleProp<TextStyle>;
  weight?: SymbolWeight;
}) {
  const materialName = MAPPING[name];

  // On web, use SVG to avoid font loading issues in Safari
  if (Platform.OS === "web" && SVG_PATHS[materialName]) {
    return (
      <Svg width={size} height={size} viewBox="0 0 24 24" fill={color as string}>
        <Path d={SVG_PATHS[materialName]} />
      </Svg>
    );
  }

  return <MaterialIcons color={color} size={size} name={materialName} style={style} />;
}
